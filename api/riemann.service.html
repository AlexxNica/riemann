<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>riemann.service documentation</title></head><body><div id="header"><h1><a href="index.html">Riemann 0.2.13-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="riemann.bin.html"><span>riemann.bin</span></a></li><li><a href="riemann.blueflood.html"><span>riemann.blueflood</span></a></li><li><a href="riemann.boundary.html"><span>riemann.boundary</span></a></li><li><a href="riemann.campfire.html"><span>riemann.campfire</span></a></li><li><a href="riemann.cloudwatch.html"><span>riemann.cloudwatch</span></a></li><li><a href="riemann.common.html"><span>riemann.common</span></a></li><li><a href="riemann.config.html"><span>riemann.config</span></a></li><li><a href="riemann.core.html"><span>riemann.core</span></a></li><li><a href="riemann.datadog.html"><span>riemann.datadog</span></a></li><li><a href="riemann.deps.html"><span>riemann.deps</span></a></li><li><a href="riemann.druid.html"><span>riemann.druid</span></a></li><li><a href="riemann.elasticsearch.html"><span>riemann.elasticsearch</span></a></li><li><a href="riemann.email.html"><span>riemann.email</span></a></li><li><a href="riemann.expiration.html"><span>riemann.expiration</span></a></li><li><a href="riemann.folds.html"><span>riemann.folds</span></a></li><li><a href="riemann.graphite.html"><span>riemann.graphite</span></a></li><li><a href="riemann.hipchat.html"><span>riemann.hipchat</span></a></li><li><a href="riemann.index.html"><span>riemann.index</span></a></li><li><a href="riemann.influxdb.html"><span>riemann.influxdb</span></a></li><li><a href="riemann.instrumentation.html"><span>riemann.instrumentation</span></a></li><li><a href="riemann.kairosdb.html"><span>riemann.kairosdb</span></a></li><li><a href="riemann.keenio.html"><span>riemann.keenio</span></a></li><li><a href="riemann.librato.html"><span>riemann.librato</span></a></li><li><a href="riemann.logentries.html"><span>riemann.logentries</span></a></li><li><a href="riemann.logging.html"><span>riemann.logging</span></a></li><li><a href="riemann.logstash.html"><span>riemann.logstash</span></a></li><li><a href="riemann.mailgun.html"><span>riemann.mailgun</span></a></li><li><a href="riemann.nagios.html"><span>riemann.nagios</span></a></li><li><a href="riemann.opentsdb.html"><span>riemann.opentsdb</span></a></li><li><a href="riemann.opsgenie.html"><span>riemann.opsgenie</span></a></li><li><a href="riemann.pagerduty.html"><span>riemann.pagerduty</span></a></li><li><a href="riemann.plugin.html"><span>riemann.plugin</span></a></li><li><a href="riemann.pool.html"><span>riemann.pool</span></a></li><li><a href="riemann.prometheus.html"><span>riemann.prometheus</span></a></li><li><a href="riemann.pubsub.html"><span>riemann.pubsub</span></a></li><li><a href="riemann.pushover.html"><span>riemann.pushover</span></a></li><li><a href="riemann.query.html"><span>riemann.query</span></a></li><li><a href="riemann.repl.html"><span>riemann.repl</span></a></li><li class="current"><a href="riemann.service.html"><span>riemann.service</span></a></li><li><a href="riemann.shinken.html"><span>riemann.shinken</span></a></li><li><a href="riemann.slack.html"><span>riemann.slack</span></a></li><li><a href="riemann.sns.html"><span>riemann.sns</span></a></li><li><a href="riemann.stackdriver.html"><span>riemann.stackdriver</span></a></li><li><a href="riemann.streams.html"><span>riemann.streams</span></a></li><li><a href="riemann.test.html"><span>riemann.test</span></a></li><li><a href="riemann.time.html"><span>riemann.time</span></a></li><li><a href="riemann.time.controlled.html"><span>riemann.time.controlled</span></a></li><li><a href="riemann.transport.html"><span>riemann.transport</span></a></li><li><a href="riemann.transport.debug.html"><span>riemann.transport.debug</span></a></li><li><a href="riemann.transport.graphite.html"><span>riemann.transport.graphite</span></a></li><li><a href="riemann.transport.opentsdb.html"><span>riemann.transport.opentsdb</span></a></li><li><a href="riemann.transport.sse.html"><span>riemann.transport.sse</span></a></li><li><a href="riemann.transport.tcp.html"><span>riemann.transport.tcp</span></a></li><li><a href="riemann.transport.udp.html"><span>riemann.transport.udp</span></a></li><li><a href="riemann.transport.websockets.html"><span>riemann.transport.websockets</span></a></li><li><a href="riemann.twilio.html"><span>riemann.twilio</span></a></li><li><a href="riemann.victorops.html"><span>riemann.victorops</span></a></li><li><a href="riemann.xymon.html"><span>riemann.xymon</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="riemann.service.html#var--%3EExecutorServiceService"><span>-&gt;ExecutorServiceService</span></a></li><li><a href="riemann.service.html#var--%3EThreadService"><span>-&gt;ThreadService</span></a></li><li><a href="riemann.service.html#var-Service"><span>Service</span></a></li><li><a href="riemann.service.html#var-all-equal%3F"><span>all-equal?</span></a></li><li><a href="riemann.service.html#var-conflict%3F"><span>conflict?</span></a></li><li><a href="riemann.service.html#var-equiv%3F"><span>equiv?</span></a></li><li><a href="riemann.service.html#var-executor-service"><span>executor-service</span></a></li><li><a href="riemann.service.html#var-literal-executor-service"><span>literal-executor-service</span></a></li><li><a href="riemann.service.html#var-map-%3EThreadService"><span>map-&gt;ThreadService</span></a></li><li><a href="riemann.service.html#var-reload%21"><span>reload!</span></a></li><li><a href="riemann.service.html#var-start%21"><span>start!</span></a></li><li><a href="riemann.service.html#var-stop%21"><span>stop!</span></a></li><li><a href="riemann.service.html#var-thread-service"><span>thread-service</span></a></li><li><a href="riemann.service.html#var-threadpool-service"><span>threadpool-service</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>riemann.service documentation</h2><pre class="doc">Lifecycle protocol for stateful services bound to a core.
</pre><div class="public" id="var--%3EExecutorServiceService"><h3>-&gt;ExecutorServiceService</h3><div class="usage"><code>(-&gt;ExecutorServiceService name equiv-key f executor stats)</code></div><pre class="doc">Positional factory function for class riemann.service.ExecutorServiceService.
</pre></div><div class="public" id="var--%3EThreadService"><h3>-&gt;ThreadService</h3><div class="usage"><code>(-&gt;ThreadService name equiv-key f core running thread)</code></div><pre class="doc">Positional factory function for class riemann.service.ThreadService.
</pre></div><div class="public" id="var-Service"><h3>Service</h3><div class="usage"></div><pre class="doc">Services are components of a core with a managed lifecycle. They're used for
stateful things like connection pools, network servers, and background
threads.</pre></div><div class="public" id="var-all-equal%3F"><h3>all-equal?</h3><div class="usage"><code>(all-equal? a b &amp; forms)</code></div><pre class="doc">Takes two objects to compare and a list of forms to compare them by.

(all-equiv? foo bar
  (class)
  (foo 2)
  (.getSize))

becomes

(let [a foo
      b bar]
  (and (= (class a) (class b))
       (= (foo 2 a) (foo 2 b))
       (= (.getSize a) (.getSize b))))</pre></div><div class="public" id="var-conflict%3F"><h3>conflict?</h3><div class="usage"><code>(conflict? service1 service2)</code></div><pre class="doc">Do these two services conflict with one another? Adding
a service to a core *replaces* any conflicting services.</pre></div><div class="public" id="var-equiv%3F"><h3>equiv?</h3><div class="usage"><code>(equiv? service1 service2)</code></div><pre class="doc">Used to identify which services can remain running through a core
transition, like reloading. If the old service is equivalent to the
new service, the old service may be preserved and used by the new
core. Otherwise, the old service may be shut down and replaced by
the new.</pre></div><div class="public" id="var-executor-service"><h3>executor-service</h3><div class="usage"><code>(executor-service name f)</code><code>(executor-service name equiv-key f)</code></div><pre class="doc">Creates a new threadpool executor service ... service! Takes a function
which generates an ExecutorService. Returns an ExecutorServiceService which
provides start/stop/reload/equiv? lifecycle management of that service.

Equivalence-key controls how services are compared to tell if they are
equivalent. Services with a nil equivalence key are *never* equivalent.
Otherwise, services are equivalent when their class, name, and equiv-key are
equal.

(executor-service* :graphite {foo: 4}
  #(ThreadPoolExecutor. 2 ...))</pre></div><div class="public" id="var-literal-executor-service"><h3>literal-executor-service</h3><div class="usage"><code>(literal-executor-service name executor-service-expr)</code></div><pre class="doc">Like executor-service, but captures the *expression* passed to it as the
equivalence key. This only works if the expression is literal; if there are
any variables or function calls, they will be compared as code, not as
their evaluated values.

OK:  (literal-executor-service :io (ThreadPoolExecutor. 2 ...))
OK:  (literal-executor-service :io (ThreadPoolExecutor. (inc 1) ...))
BAD: (literal-executor-service :io (ThreadPoolExecutor. x ...))</pre></div><div class="public" id="var-map-%3EThreadService"><h3>map-&gt;ThreadService</h3><div class="usage"><code>(map-&gt;ThreadService m__6522__auto__)</code></div><pre class="doc">Factory function for class riemann.service.ThreadService, taking a map of keywords to field values.
</pre></div><div class="public" id="var-reload%21"><h3>reload!</h3><div class="usage"><code>(reload! service core)</code></div><pre class="doc">Informs the service of a change in core.
</pre></div><div class="public" id="var-start%21"><h3>start!</h3><div class="usage"><code>(start! service)</code></div><pre class="doc">Starts a service. Must be idempotent.
</pre></div><div class="public" id="var-stop%21"><h3>stop!</h3><div class="usage"><code>(stop! service)</code></div><pre class="doc">Stops a service. Must be idempotent.
</pre></div><div class="public" id="var-thread-service"><h3>thread-service</h3><div class="usage"><code>(thread-service name f)</code><code>(thread-service name equiv-key f)</code></div><pre class="doc">Returns a ThreadService which will call (f core) repeatedly when started.
Will only stop between calls to f. Start and stop are blocking operations.
Equivalent to other ThreadServices with the same name and equivalence key--
if not provided, defaults nil. Conflicts with other ThreadServices of the
same name.</pre></div><div class="public" id="var-threadpool-service"><h3>threadpool-service</h3><div class="usage"><code>(threadpool-service name)</code><code>(threadpool-service name {:keys [core-pool-size max-pool-size keep-alive-time keep-alive-unit queue-size], :as opts, :or {core-pool-size 1, max-pool-size 128, keep-alive-time 10, keep-alive-unit TimeUnit/MILLISECONDS, queue-size 1000}})</code></div><pre class="doc">An ExecutorServiceService based on a ThreadPoolExecutor with core and
maximum threadpool sizes, and a LinkedBlockingQueue of a given size. Options:

:core-pool-size             Default 1
:max-pool-size              Default 128
:keep-alive-time            Default 10
:keep-alive-unit            Default MILLISECONDS
:queue-size                 Default 1000</pre></div></div></body></html>