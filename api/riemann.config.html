<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>riemann.config documentation</title></head><body><div id="header"><h1><a href="index.html">Riemann 0.2.13-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="riemann.bin.html"><span>riemann.bin</span></a></li><li><a href="riemann.blueflood.html"><span>riemann.blueflood</span></a></li><li><a href="riemann.boundary.html"><span>riemann.boundary</span></a></li><li><a href="riemann.campfire.html"><span>riemann.campfire</span></a></li><li><a href="riemann.cloudwatch.html"><span>riemann.cloudwatch</span></a></li><li><a href="riemann.common.html"><span>riemann.common</span></a></li><li class="current"><a href="riemann.config.html"><span>riemann.config</span></a></li><li><a href="riemann.core.html"><span>riemann.core</span></a></li><li><a href="riemann.datadog.html"><span>riemann.datadog</span></a></li><li><a href="riemann.deps.html"><span>riemann.deps</span></a></li><li><a href="riemann.druid.html"><span>riemann.druid</span></a></li><li><a href="riemann.elasticsearch.html"><span>riemann.elasticsearch</span></a></li><li><a href="riemann.email.html"><span>riemann.email</span></a></li><li><a href="riemann.expiration.html"><span>riemann.expiration</span></a></li><li><a href="riemann.folds.html"><span>riemann.folds</span></a></li><li><a href="riemann.graphite.html"><span>riemann.graphite</span></a></li><li><a href="riemann.hipchat.html"><span>riemann.hipchat</span></a></li><li><a href="riemann.index.html"><span>riemann.index</span></a></li><li><a href="riemann.influxdb.html"><span>riemann.influxdb</span></a></li><li><a href="riemann.instrumentation.html"><span>riemann.instrumentation</span></a></li><li><a href="riemann.kairosdb.html"><span>riemann.kairosdb</span></a></li><li><a href="riemann.keenio.html"><span>riemann.keenio</span></a></li><li><a href="riemann.librato.html"><span>riemann.librato</span></a></li><li><a href="riemann.logentries.html"><span>riemann.logentries</span></a></li><li><a href="riemann.logging.html"><span>riemann.logging</span></a></li><li><a href="riemann.logstash.html"><span>riemann.logstash</span></a></li><li><a href="riemann.mailgun.html"><span>riemann.mailgun</span></a></li><li><a href="riemann.nagios.html"><span>riemann.nagios</span></a></li><li><a href="riemann.opentsdb.html"><span>riemann.opentsdb</span></a></li><li><a href="riemann.opsgenie.html"><span>riemann.opsgenie</span></a></li><li><a href="riemann.pagerduty.html"><span>riemann.pagerduty</span></a></li><li><a href="riemann.plugin.html"><span>riemann.plugin</span></a></li><li><a href="riemann.pool.html"><span>riemann.pool</span></a></li><li><a href="riemann.prometheus.html"><span>riemann.prometheus</span></a></li><li><a href="riemann.pubsub.html"><span>riemann.pubsub</span></a></li><li><a href="riemann.pushover.html"><span>riemann.pushover</span></a></li><li><a href="riemann.query.html"><span>riemann.query</span></a></li><li><a href="riemann.repl.html"><span>riemann.repl</span></a></li><li><a href="riemann.service.html"><span>riemann.service</span></a></li><li><a href="riemann.shinken.html"><span>riemann.shinken</span></a></li><li><a href="riemann.slack.html"><span>riemann.slack</span></a></li><li><a href="riemann.sns.html"><span>riemann.sns</span></a></li><li><a href="riemann.stackdriver.html"><span>riemann.stackdriver</span></a></li><li><a href="riemann.streams.html"><span>riemann.streams</span></a></li><li><a href="riemann.test.html"><span>riemann.test</span></a></li><li><a href="riemann.time.html"><span>riemann.time</span></a></li><li><a href="riemann.time.controlled.html"><span>riemann.time.controlled</span></a></li><li><a href="riemann.transport.html"><span>riemann.transport</span></a></li><li><a href="riemann.transport.debug.html"><span>riemann.transport.debug</span></a></li><li><a href="riemann.transport.graphite.html"><span>riemann.transport.graphite</span></a></li><li><a href="riemann.transport.opentsdb.html"><span>riemann.transport.opentsdb</span></a></li><li><a href="riemann.transport.sse.html"><span>riemann.transport.sse</span></a></li><li><a href="riemann.transport.tcp.html"><span>riemann.transport.tcp</span></a></li><li><a href="riemann.transport.udp.html"><span>riemann.transport.udp</span></a></li><li><a href="riemann.transport.websockets.html"><span>riemann.transport.websockets</span></a></li><li><a href="riemann.twilio.html"><span>riemann.twilio</span></a></li><li><a href="riemann.victorops.html"><span>riemann.victorops</span></a></li><li><a href="riemann.xymon.html"><span>riemann.xymon</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="riemann.config.html#var-*config-file*"><span>*config-file*</span></a></li><li><a href="riemann.config.html#var-apply%21"><span>apply!</span></a></li><li><a href="riemann.config.html#var-async-queue%21"><span>async-queue!</span></a></li><li><a href="riemann.config.html#var-clear%21"><span>clear!</span></a></li><li><a href="riemann.config.html#var-config-file-path"><span>config-file-path</span></a></li><li><a href="riemann.config.html#var-core"><span>core</span></a></li><li><a href="riemann.config.html#var-delete-from-index"><span>delete-from-index</span></a></li><li><a href="riemann.config.html#var-depend"><span>depend</span></a></li><li><a href="riemann.config.html#var-graphite-server"><span>graphite-server</span></a></li><li><a href="riemann.config.html#var-include"><span>include</span></a></li><li><a href="riemann.config.html#var-index"><span>index</span></a></li><li><a href="riemann.config.html#var-instrumentation"><span>instrumentation</span></a></li><li><a href="riemann.config.html#var-kwargs-or-map"><span>kwargs-or-map</span></a></li><li><a href="riemann.config.html#var-local-repo"><span>local-repo</span></a></li><li><a href="riemann.config.html#var-next-core"><span>next-core</span></a></li><li><a href="riemann.config.html#var-opentsdb-server"><span>opentsdb-server</span></a></li><li><a href="riemann.config.html#var-periodically-expire"><span>periodically-expire</span></a></li><li><a href="riemann.config.html#var-publish"><span>publish</span></a></li><li><a href="riemann.config.html#var-read-strings"><span>read-strings</span></a></li><li><a href="riemann.config.html#var-reinject"><span>reinject</span></a></li><li><a href="riemann.config.html#var-repl-server"><span>repl-server</span></a></li><li><a href="riemann.config.html#var-service%21"><span>service!</span></a></li><li><a href="riemann.config.html#var-sse-server"><span>sse-server</span></a></li><li><a href="riemann.config.html#var-start%21"><span>start!</span></a></li><li><a href="riemann.config.html#var-stop%21"><span>stop!</span></a></li><li><a href="riemann.config.html#var-streams"><span>streams</span></a></li><li><a href="riemann.config.html#var-subscribe"><span>subscribe</span></a></li><li><a href="riemann.config.html#var-tcp-server"><span>tcp-server</span></a></li><li><a href="riemann.config.html#var-udp-server"><span>udp-server</span></a></li><li><a href="riemann.config.html#var-update-index"><span>update-index</span></a></li><li><a href="riemann.config.html#var-validate-config"><span>validate-config</span></a></li><li><a href="riemann.config.html#var-ws-server"><span>ws-server</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>riemann.config documentation</h2><pre class="doc">Riemann config files are eval'd in the context of this namespace. Includes
streams, client, email, logging, and graphite; the common functions used in
config. Provides a default core and functions ((tcp|udp)-server, streams,
index, reinject) which operate on that core.</pre><div class="public" id="var-*config-file*"><h3>*config-file*</h3><div class="usage"></div><pre class="doc">The config file currently being included.
</pre></div><div class="public" id="var-apply%21"><h3>apply!</h3><div class="usage"><code>(apply!)</code></div><pre class="doc">Applies pending changes to the core. Transitions the current core to the
next one, and resets the next core.</pre></div><div class="public" id="var-async-queue%21"><h3>async-queue!</h3><div class="usage"><code>(async-queue! name threadpool-service-opts &amp; children)</code></div><pre class="doc">A stream which registers (using service!) a new threadpool-service with the
next core, and returns a stream which accepts events and applies those events
to child streams via the threadpool service.

WARNING: this function is not intended for dynamic use. It creates a new
executor service for *every* invocation. It will not start the executor
service until the current configuration is applied. Use sparingly and only at
configuration time--preferably once for each distinct IO-bound asynchronous
service.

See `riemann.service/threadpool-service` for options.

Example:

(let [downstream (batch 100 1/10
                        (async-queue! :agg {:queue-size     1e3
                                            :core-pool-size 4
                                            :max-pool-size  32}
                          (forward
                            (riemann.client/tcp-client
                              :host &quot;127.0.0.1&quot;))))]
  (streams
    ...
    ; Forward all events downstream to the aggregator.
    (where (service #&quot;^riemann.*&quot;)
      downstream)))</pre></div><div class="public" id="var-clear%21"><h3>clear!</h3><div class="usage"><code>(clear!)</code></div><pre class="doc">Resets the next core.
</pre></div><div class="public" id="var-config-file-path"><h3>config-file-path</h3><div class="usage"><code>(config-file-path path)</code></div><pre class="doc">Computes the full path to a config file. Absolute paths are returned
unchanged. Relative paths are expanded relative to *config-file*. Returns a
string.</pre></div><div class="public" id="var-core"><h3>core</h3><div class="usage"></div><pre class="doc">The currently running core.
</pre></div><div class="public" id="var-delete-from-index"><h3>delete-from-index</h3><div class="usage"><code>(delete-from-index)</code><code>(delete-from-index fields)</code></div><pre class="doc">Deletes any events that pass through from the index. By default, deletes
events with the same host and service. If a field, or a list of fields, is
given, deletes any events with matching values for all of those fields.

; Delete all events in the index with the same host
(delete-from-index :host event)

; Delete all events in the index with the same host and state.
(delete-from-index [:host :state] event)</pre></div><div class="public" id="var-depend"><h3>depend</h3><div class="usage"><code>(depend plugin artifact version options)</code></div><pre class="doc">Pull in specified dependencies. This combines pulling dependencies with
aether and loading a plugin.

The option map is fed to com.cemerick.pomegranate/add-dependencies and
accepts an optional :exit-on-failure keyword defaulting to true which
indicates whether riemann should bail out when failing to load a plugin
as well as an option :alias parameter which will be forward to `load-plugin`

To prefer https, only the clojars repository is registered by default.</pre></div><div class="public" id="var-graphite-server"><h3>graphite-server</h3><div class="usage"><code>(graphite-server &amp; opts)</code></div><pre class="doc">Add a new Graphite TCP server with opts to the default core.

(graphite-server {:port 2222})</pre></div><div class="public" id="var-include"><h3>include</h3><div class="usage"><code>(include path)</code></div><pre class="doc">Include another config file or directory. If the path points to a
 directory, all files with names ending in `.config` or `.clj` within
 it will be loaded recursively.

; Relative to the current config file, or cwd
(include &quot;foo.clj&quot;)

; Absolute path
(include &quot;/foo/bar.clj&quot;)</pre></div><div class="public" id="var-index"><h3>index</h3><div class="usage"><code>(index &amp; opts)</code></div><pre class="doc">Set the index used by this core. Returns the index.
</pre></div><div class="public" id="var-instrumentation"><h3>instrumentation</h3><div class="usage"><code>(instrumentation &amp; opts)</code></div><pre class="doc">Replaces the default core's instrumentation service with a new one, using
the given options. If you prefer not to receive any events about Riemann's
well-being, you can pass :enabled? false.

(instrumentation {:interval 5
                  :enabled? false})</pre></div><div class="public" id="var-kwargs-or-map"><h3>kwargs-or-map</h3><div class="usage"><code>(kwargs-or-map opts)</code></div><pre class="doc">Takes a sequence of arguments like

[{:foo 2 :bar 3}]
[:foo 2 :bar 3]

as would be passed to a function taking either kwargs or an options map, and
returns an options map.</pre></div><div class="public" id="var-local-repo"><h3>local-repo</h3><div class="usage"><code>(local-repo path)</code></div><pre class="doc">Sets the location of the local maven repository used
by `depend` to load plugins</pre></div><div class="public" id="var-next-core"><h3>next-core</h3><div class="usage"></div><pre class="doc">The core which will replace the current core.
</pre></div><div class="public" id="var-opentsdb-server"><h3>opentsdb-server</h3><div class="usage"><code>(opentsdb-server &amp; opts)</code></div><pre class="doc">Add a new OpenTSDB TCP server with opts to the default core.

(opentsdb-server {:port 4242})</pre></div><div class="public" id="var-periodically-expire"><h3>periodically-expire</h3><div class="usage"><code>(periodically-expire)</code><code>(periodically-expire &amp; args)</code></div><pre class="doc">Sets up a reaper for this core. See riemann.core/reaper.
</pre></div><div class="public" id="var-publish"><h3>publish</h3><div class="usage"><code>(publish channel)</code></div><pre class="doc">Returns a stream which publishes events to the given channel. Uses this
core's pubsub registry.</pre></div><div class="public" id="var-read-strings"><h3>read-strings</h3><div class="usage"><code>(read-strings string)</code><code>(read-strings forms reader)</code></div><pre class="doc">Returns a sequence of forms read from string.
</pre></div><div class="public" id="var-reinject"><h3>reinject</h3><div class="usage"><code>(reinject event)</code></div><pre class="doc">A stream which applies any events it receives back into the current core.
You almost never need this: it makes it easy to create infinite loops, and
it's rarely the case that you *need* top-level recursion. Where possible,
prefer a stream that passes events to children.

(with :metric 1 reinject)</pre></div><div class="public" id="var-repl-server"><h3>repl-server</h3><div class="usage"><code>(repl-server &amp; opts)</code></div><pre class="doc">Starts a new REPL server with opts.
</pre></div><div class="public" id="var-service%21"><h3>service!</h3><div class="usage"><code>(service! service)</code></div><pre class="doc">Ensures that a given service, or its equivalent, is in the next core. If the
current core includes an equivalent service, uses that service instead.
Returns the service which will be used in the final core.

This allows configuration to specify and use services in a way which can,
where possible, re-use existing services without interruption--e.g., when
reloading. For example, say you want to use a threadpool executor:

(let [executor (service! (ThreadPoolExecutor. 1 2 ...))]
  (where (service &quot;graphite&quot;)
    (on executor
      graph)))

If you reload this config, the *old* executor is busily processing messages
from the old set of streams. When the new config evaluates (service! ...)
it creates a new ThreadPoolExecutor and compares it to the existing core's
services. If it's equivalent, service! will re-use the *existing*
executor, which prevents having to shut down the old executor.

But if you *change* the dynamics of the new executor somehow--maybe by
adjusting a queue depth or max pool size--they won't compare as equivalent.
When the core transitions, the old executor will be shut down, and the new
one used to handle any further graphite events.

Note: Yeah, this does duplicate some of the work done in core/transition!.
No, I'm not really sure what to do about it. Maybe we need a named service
registry so all lookups are dynamic. :-/</pre></div><div class="public" id="var-sse-server"><h3>sse-server</h3><div class="usage"><code>(sse-server &amp; opts)</code></div><pre class="doc">Add a new SSE channel server with opts to the default core.

(sse-server {:port 5556})</pre></div><div class="public" id="var-start%21"><h3>start!</h3><div class="usage"><code>(start!)</code></div><pre class="doc">Start the current core.
</pre></div><div class="public" id="var-stop%21"><h3>stop!</h3><div class="usage"><code>(stop!)</code></div><pre class="doc">Stop the current core.
</pre></div><div class="public" id="var-streams"><h3>streams</h3><div class="usage"><code>(streams &amp; things)</code></div><pre class="doc">Add any number of streams to the default core.
</pre></div><div class="public" id="var-subscribe"><h3>subscribe</h3><div class="usage"><code>(subscribe channel f)</code></div><pre class="doc">Subscribes to the given channel with f, which will receive events. Uses the
current core's pubsub registry always, because the next core's registry will
be discarded by core/transition.

Returns a single-arity function that does nothing with its inputs and, when
invoked, returns the subscription you created. Why do this weird thing? So
you can pretend (subscribe ...) is a stream, and use it in the same context
as your other streams, like (publish).</pre></div><div class="public" id="var-tcp-server"><h3>tcp-server</h3><div class="usage"><code>(tcp-server &amp; opts)</code></div><pre class="doc">Add a new TCP server with opts to the default core.

(tcp-server {:host &quot;localhost&quot; :port 5555})</pre></div><div class="public" id="var-udp-server"><h3>udp-server</h3><div class="usage"><code>(udp-server &amp; opts)</code></div><pre class="doc">Add a new UDP server with opts to the default core.

(udp-server {:port 5555})</pre></div><div class="public" id="var-update-index"><h3>update-index</h3><div class="usage"><code>(update-index index)</code></div><pre class="doc">Updates the given index with all events received. Also publishes to the
index pubsub channel.</pre></div><div class="public" id="var-validate-config"><h3>validate-config</h3><div class="usage"><code>(validate-config file)</code></div><pre class="doc">Check that a config file has valid syntax.
</pre></div><div class="public" id="var-ws-server"><h3>ws-server</h3><div class="usage"><code>(ws-server &amp; opts)</code></div><pre class="doc">Add a new websockets server with opts to the default core.

(ws-server {:port 5556})</pre></div></div></body></html>