<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>riemann.query documentation</title></head><body><div id="header"><h1><a href="index.html">Riemann 0.2.12 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="riemann.bin.html"><span>riemann.bin</span></a></li><li><a href="riemann.blueflood.html"><span>riemann.blueflood</span></a></li><li><a href="riemann.boundary.html"><span>riemann.boundary</span></a></li><li><a href="riemann.campfire.html"><span>riemann.campfire</span></a></li><li><a href="riemann.cloudwatch.html"><span>riemann.cloudwatch</span></a></li><li><a href="riemann.common.html"><span>riemann.common</span></a></li><li><a href="riemann.config.html"><span>riemann.config</span></a></li><li><a href="riemann.core.html"><span>riemann.core</span></a></li><li><a href="riemann.datadog.html"><span>riemann.datadog</span></a></li><li><a href="riemann.deps.html"><span>riemann.deps</span></a></li><li><a href="riemann.druid.html"><span>riemann.druid</span></a></li><li><a href="riemann.elasticsearch.html"><span>riemann.elasticsearch</span></a></li><li><a href="riemann.email.html"><span>riemann.email</span></a></li><li><a href="riemann.expiration.html"><span>riemann.expiration</span></a></li><li><a href="riemann.folds.html"><span>riemann.folds</span></a></li><li><a href="riemann.graphite.html"><span>riemann.graphite</span></a></li><li><a href="riemann.hipchat.html"><span>riemann.hipchat</span></a></li><li><a href="riemann.index.html"><span>riemann.index</span></a></li><li><a href="riemann.influxdb.html"><span>riemann.influxdb</span></a></li><li><a href="riemann.instrumentation.html"><span>riemann.instrumentation</span></a></li><li><a href="riemann.kairosdb.html"><span>riemann.kairosdb</span></a></li><li><a href="riemann.keenio.html"><span>riemann.keenio</span></a></li><li><a href="riemann.librato.html"><span>riemann.librato</span></a></li><li><a href="riemann.logentries.html"><span>riemann.logentries</span></a></li><li><a href="riemann.logging.html"><span>riemann.logging</span></a></li><li><a href="riemann.logstash.html"><span>riemann.logstash</span></a></li><li><a href="riemann.mailgun.html"><span>riemann.mailgun</span></a></li><li><a href="riemann.nagios.html"><span>riemann.nagios</span></a></li><li><a href="riemann.opentsdb.html"><span>riemann.opentsdb</span></a></li><li><a href="riemann.opsgenie.html"><span>riemann.opsgenie</span></a></li><li><a href="riemann.pagerduty.html"><span>riemann.pagerduty</span></a></li><li><a href="riemann.plugin.html"><span>riemann.plugin</span></a></li><li><a href="riemann.pool.html"><span>riemann.pool</span></a></li><li><a href="riemann.prometheus.html"><span>riemann.prometheus</span></a></li><li><a href="riemann.pubsub.html"><span>riemann.pubsub</span></a></li><li><a href="riemann.pushover.html"><span>riemann.pushover</span></a></li><li class="current"><a href="riemann.query.html"><span>riemann.query</span></a></li><li><a href="riemann.repl.html"><span>riemann.repl</span></a></li><li><a href="riemann.service.html"><span>riemann.service</span></a></li><li><a href="riemann.shinken.html"><span>riemann.shinken</span></a></li><li><a href="riemann.slack.html"><span>riemann.slack</span></a></li><li><a href="riemann.sns.html"><span>riemann.sns</span></a></li><li><a href="riemann.stackdriver.html"><span>riemann.stackdriver</span></a></li><li><a href="riemann.streams.html"><span>riemann.streams</span></a></li><li><a href="riemann.test.html"><span>riemann.test</span></a></li><li><a href="riemann.time.html"><span>riemann.time</span></a></li><li><a href="riemann.time.controlled.html"><span>riemann.time.controlled</span></a></li><li><a href="riemann.transport.html"><span>riemann.transport</span></a></li><li><a href="riemann.transport.debug.html"><span>riemann.transport.debug</span></a></li><li><a href="riemann.transport.graphite.html"><span>riemann.transport.graphite</span></a></li><li><a href="riemann.transport.opentsdb.html"><span>riemann.transport.opentsdb</span></a></li><li><a href="riemann.transport.sse.html"><span>riemann.transport.sse</span></a></li><li><a href="riemann.transport.tcp.html"><span>riemann.transport.tcp</span></a></li><li><a href="riemann.transport.udp.html"><span>riemann.transport.udp</span></a></li><li><a href="riemann.transport.websockets.html"><span>riemann.transport.websockets</span></a></li><li><a href="riemann.twilio.html"><span>riemann.twilio</span></a></li><li><a href="riemann.victorops.html"><span>riemann.victorops</span></a></li><li><a href="riemann.xymon.html"><span>riemann.xymon</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="riemann.query.html#var-antlr-%3East"><span>antlr-&gt;ast</span></a></li><li><a href="riemann.query.html#var-ast"><span>ast</span></a></li><li><a href="riemann.query.html#var-ast-predicate"><span>ast-predicate</span></a></li><li><a href="riemann.query.html#var-ast-prefix"><span>ast-prefix</span></a></li><li><a href="riemann.query.html#var-ast-regex"><span>ast-regex</span></a></li><li><a href="riemann.query.html#var-clj-ast"><span>clj-ast</span></a></li><li><a href="riemann.query.html#var-clj-ast-field"><span>clj-ast-field</span></a></li><li><a href="riemann.query.html#var-clj-ast-guarded-prefix"><span>clj-ast-guarded-prefix</span></a></li><li><a href="riemann.query.html#var-clj-ast-regex-match"><span>clj-ast-regex-match</span></a></li><li><a href="riemann.query.html#var-clj-ast-tagged"><span>clj-ast-tagged</span></a></li><li><a href="riemann.query.html#var-fun"><span>fun</span></a></li><li><a href="riemann.query.html#var-fun-cache"><span>fun-cache</span></a></li><li><a href="riemann.query.html#var-make-regex"><span>make-regex</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>riemann.query documentation</h2><pre class="doc">The query parser. Parses strings into ASTs, and converts ASTs to functions
which match events.</pre><div class="public" id="var-antlr-%3East"><h3>antlr-&gt;ast</h3><div class="usage"><code>(antlr-&gt;ast [node-type &amp; terms])</code></div><pre class="doc">Converts a parse tree to an intermediate AST which is a little easier to
analyze and work with. This is the AST we use for optimization and which is
passed to various query compilers. Turns literals into their equivalent JVM
types, and eliminates some unnecessary parser structure.</pre></div><div class="public" id="var-ast"><h3>ast</h3><div class="usage"><code>(ast string)</code></div><pre class="doc">Takes a string to a general AST.
</pre></div><div class="public" id="var-ast-predicate"><h3>ast-predicate</h3><div class="usage"><code>(ast-predicate terms)</code></div><pre class="doc">Rewrites predicates with and/or/not to normal Clojure forms.
</pre></div><div class="public" id="var-ast-prefix"><h3>ast-prefix</h3><div class="usage"><code>(ast-prefix sym [t1 _ t2])</code></div><pre class="doc">Rewrites binary expressions from infix to prefix. Takes a symbol `(e.g. '=)`
and a 3-element seq like `(1 &quot;=&quot; 2)` and emits `(= 1 2)`, ignoring the
middle term and transforming t1 and t2.</pre></div><div class="public" id="var-ast-regex"><h3>ast-regex</h3><div class="usage"><code>(ast-regex type [string _ pattern])</code></div><pre class="doc">Takes a type of match (:like or :regex), a list of three string terms: an
AST resolving to a string, the literal =~ (ignored), and a pattern. Returns
`(:regex pattern string-ast)`.

For :regex matches, emits a regular expression pattern.
For :like matches, emits a string pattern.</pre></div><div class="public" id="var-clj-ast"><h3>clj-ast</h3><div class="usage"><code>(clj-ast ast)</code></div><pre class="doc">Rewrites an AST to eval-able Clojure forms.
</pre></div><div class="public" id="var-clj-ast-field"><h3>clj-ast-field</h3><div class="usage"><code>(clj-ast-field field)</code></div><pre class="doc">Takes a keyword field name and emits an expression to extract that field
from an 'event map, e.g. `(:fieldname event)`.</pre></div><div class="public" id="var-clj-ast-guarded-prefix"><h3>clj-ast-guarded-prefix</h3><div class="usage"><code>(clj-ast-guarded-prefix f check [a b])</code></div><pre class="doc">Like prefix, but inserts a predicate check around both terms.
</pre></div><div class="public" id="var-clj-ast-regex-match"><h3>clj-ast-regex-match</h3><div class="usage"><code>(clj-ast-regex-match pattern-transformer [pattern field])</code></div><pre class="doc">Takes a pattern transformer, and a list of [pattern string-ast], and emits
code to match the string-ast's results with a regex match, compiling pattern
with pattern-transformer.</pre></div><div class="public" id="var-clj-ast-tagged"><h3>clj-ast-tagged</h3><div class="usage"><code>(clj-ast-tagged tag)</code></div><pre class="doc">Takes a tag and emits an expression to match that tag in an event.
</pre></div><div class="public" id="var-fun"><h3>fun</h3><div class="usage"><code>(fun ast)</code></div><pre class="doc">Transforms an AST into a fn [event] which returns true if the query matches
that event. Example:

(def q (fun (ast &quot;metric &gt; 2&quot;)))
(q {:metric 1}) =&gt; false
(q {:metric 3}) =&gt; true</pre></div><div class="public" id="var-fun-cache"><h3>fun-cache</h3><div class="usage"></div><pre class="doc">Speeds up the compilation of queries by caching map of ASTs to corresponding
functions.</pre></div><div class="public" id="var-make-regex"><h3>make-regex</h3><div class="usage"><code>(make-regex string)</code></div><pre class="doc">Convert a string like &quot;foo%&quot; into /^foo.*$/
</pre></div></div></body></html>